<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Babylon.js Animation Example</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css">
  
 

    <style>
        
        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
    


</head>
<body>

    
    <!-- Bootstrap Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Error</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="errorModalBody">
                    <!-- Error message goes here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <canvas id="renderCanvas"></canvas>
    <script src="SceneAndMeshLoader.js"></script>
    <script src="AnimationLoader.js"></script>
    <script src="playAnims.js"></script>
    <script>

////TODO/////////////////////////////
//    _
//   /_\
//  //\\
// //  \\
// |    |
// `----'
// PINEAPPLE 
// TODO:
// Camera lock op actor
// Camera vector HOEK
// Camera vector AFSTAND
// loading screen
// blendshapes
// keuze avatar
// Laden meerdere avatars






var glos


              document.addEventListener("DOMContentLoaded", function() {
                    var urlParams = new URLSearchParams(window.location.search);
                    glos = urlParams.get('glos');
                    console.log(glos)

                    if(glos == null){
                        $("#errorModalBody").text("No glos file specified")
                        $("#errorModal").modal("show")
                    }
                });


        async function initialize() {

            [scene, engine, loaded] =  await createScene(document.getElementById("renderCanvas"))

 // Run the render loop
 engine.runRenderLoop(function () {
                scene.render();
            });

            // Resize the canvas when the window is resized
            window.addEventListener("resize", function () {
                engine.resize();
            });

            if(engine)
            {
                if (await getAnims(scene, loaded, glos)) {
                    playLoadedAnims();
                }
            }



           
        }

        initialize().catch(error => {
            console.error('Failed to initialize:', error);
        });

        function loadAnims() {
            if (scene && loaded) {
                
                getAnims(scene, loaded, glos);
            } else {
                console.error('Scene or loaded variables are not set.');
            }
        }

        function playLoadedAnims() {
            if (scene && loaded) {
                playAnims(scene, loaded);
            } else {
                console.error('Scene or loaded variables are not set.');
            }
        }
        function logMeshForward() {
            // Log the forward vector of the mesh every second
            setInterval(() => {
                if(loaded.meshes[1]) {
                    // Get the forward vector of the mesh
                    const forward = loaded.meshes[1].forward;

                    // Log the forward vector
                    console.log("Forward Vector:", forward);
                } else {
                    console.log("Mesh is not loaded.");
                }
            }, 1000); // Log every 1 second
        }

    </script>
    <!-- <button onclick="(async function() { await getAnims(scene, loaded)});">Load Anims</button> -->
    <button onclick="loadAnims()">Load Anims</button>
    <button onclick="playLoadedAnims()">Play Anims</button>
    <button onclick="logMeshForward()">Log Forward</button>
    <!-- <button onclick="getAnims(scene, mesh)">Load Anims</button> -->
</body>
</html>
